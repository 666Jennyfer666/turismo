(this.$WP=this.$WP||[]).push(["wv1t5y",(e,t)=>{"use strict";var r,a,n,s,i,o,c,l,u,p,h,m,f=({pollingCall:e,completeResponsePredicate:t,pollInterval:a=1e3,maxTries:n=10,pause:s=!1})=>{var i=r.useRef(),o=r.useRef(0),c=r.useRef((()=>{})),[l,u]=r.useState({fetching:!s,refetch:()=>{}}),[p,h]=r.useState(s),m=r.useCallback((()=>{c.current()}),[]);return r.useEffect((()=>{var e=l.data&&t(l.data);!p||s||e||(h(!1),u({fetching:!0,refetch:m}))}),[m,t,l.data,s,p]),r.useEffect((()=>{if(p)return()=>{};var r=()=>{if(o.current<n){o.current+=1;var s=o.current;e().then((e=>{o.current===s&&t(e)&&(u({fetching:!1,data:e,refetch:m}),clearTimeout(i.current))})).catch((e=>{})),i.current=setTimeout(r,a)}else u({fetching:!1,refetch:m})};return c.current=()=>{p||(o.current=0,r(),u({fetching:!0,refetch:m}))},r(),()=>{i.current&&clearTimeout(i.current)}}),[p]),l},d=(e,t)=>{var r=t.notifications&&t.notifications.find((({cartItemId:t})=>t===e.id)),a=r&&r.notificationType||null;return{...e,notificationType:a}},S=e=>fetch(e?"/ShoppingCartApi/cart/summary?isCartless=true":"/ShoppingCartApi/cart/summary",{credentials:"same-origin"}).then((t=>t.ok?t:(console.error(`[ShoppingCart] Failed fetching ${e?"checkout":"cart"} summary`,JSON.stringify(t)),Promise.reject()))).then((e=>e.json())),g=()=>S(!1),C=()=>S(!0),y=e=>e&&"IN_PROGRESS"!==e.polling_state,v=({checkout:e,runQuery:t=!0,useRobotSafe:a=!0,verifyEmptyData:f=!0})=>{var g,[C,v]=r.useState("Fetching"),[E,D]=r.useState(!1),P=n(),R=i.useConstantIncrementCallback();r.useEffect((()=>{t?a&&!P?D(!1):f?S(e).then((e=>{R(o.success,c.fetch),0===e.itemCount?v("NoItem"):D(!0)})).catch((()=>{R(o.error,c.fetch),v("Failed")})):D(!0):v("Abort")}),[e,t,f,P,a,R]);var I=m({pollingCall:()=>((e=!1)=>fetch(e?"/ShoppingCartApi/cart/detail?detailLevel=product&isCartless=true":"/ShoppingCartApi/cart/detail?detailLevel=product",{credentials:"same-origin"}).then((e=>e.ok?e.json():(console.error("[ShoppingCart] detail",JSON.stringify(e)),Promise.reject()))).catch((()=>({polling_state:"ERROR",result:null}))))(e),completeResponsePredicate:y,pollInterval:2e3,maxTries:5,pause:!E}),{fetching:T,data:j}=I,k=s(T),w=!T&&(null==j||null==(g=j.result)?void 0:g.cart)||null,b=(null==w?void 0:w.items)||null,O=l.useIncrementCallback(u.success,p.fetch,e?h.true:h.false),x=l.useIncrementCallback(u.error,p.fetch,e?h.true:h.false);return r.useEffect((()=>{null!=k&&k&&!T&&(v(b?"Success":"Failed"),b?O():x())}),[T,k,b,O,x]),{status:C,data:w&&b&&b.map((e=>d(e,w)))}},E=e=>e&&"IN_PROGRESS"!==e.polling_state,D=e=>{var t,{fetching:r,data:n,refetch:s}=m({pollingCall:()=>(e=>fetch((e=>{var t=new URLSearchParams({});return e&&t.append("isCartless",String(e)),`/ShoppingCartApi/cart/detail?detailLevel=product&${t.toString()}`})(e),{credentials:"same-origin"}).then((e=>e.ok?e.json():Promise.reject(Error(JSON.stringify(e))))).catch((e=>(console.error("[ShoppingCart] poll cart page detail",e),{polling_state:"ERROR",result:null}))))(e),completeResponsePredicate:E,pollInterval:2e3,maxTries:5}),i=!r&&(null==n||null==(t=n.result)?void 0:t.cart)||null,o=a((()=>{var e=(null==i?void 0:i.items)||null;return i?{cartItems:(null==e?void 0:e.map((e=>d(e,i))))||null,notifications:i.notifications,orderDetails:i.orderDetails,displayData:i.displayData}:null}),[i]);return{status:r?"Fetching":i?"Success":"Failed",data:o,refetch:s}},P=e=>fetch("/ShoppingCartApi/cart/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cartItemId:e}),credentials:"same-origin"}).then((e=>e.ok?e.json():Promise.reject(new Error(`The response was not \`ok\`: ${e.status}`)))).then((e=>e&&"SUCCESS"===e.status?e.cart:Promise.reject(new Error("The remove from cart query was not a success")))).then((e=>{var t;return null===e?Promise.reject(new Error("The remove from cart query was not a success: Cart items null")):{cartItems:(null==(t=e.items)?void 0:t.map((t=>d(t,e))))||null,notifications:e.notifications,orderDetails:e.orderDetails,displayData:e.displayData}})),R=e=>fetch("/ShoppingCartApi/cart/deleteNotifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notificationIds:e}),credentials:"same-origin"}).then((e=>e.ok?e.json():Promise.reject(new Error(`The response was not \`ok\`: ${e.status}`)))).then((e=>e&&"SUCCESS"===e.status?e.cart:Promise.reject(new Error(`The delete notification was not a success: ${null==e?void 0:e.status}`)))).then((e=>{var t;return null===e?Promise.reject(new Error("The delete notification query was not a success: Cart items null")):{cartItems:(null==(t=e.items)?void 0:t.map((t=>d(t,e))))||null,notifications:e.notifications,orderDetails:e.orderDetails,displayData:e.displayData}}));return[()=>{m=f,e({fetchCartSummary:g,fetchCheckoutSummary:C,fetchDeleteNotifications:R,fetchRemoveFromCart:P,useFetchCartPageData:D,useFetchShoppingData:v})},[e=>(r=e,a=e.useMemo),e=>n=e.useIsRobotSafe,e=>s=e.default,e=>(i=e.ExperiencesCartSummary,o=e.ExperiencesCartSummaryStatus,c=e.ExperiencesCartSummarySource,l=e.ExperiencesCartData,u=e.ExperiencesCartDataStatus,p=e.ExperiencesCartDataSource,h=e.ExperiencesCartDataCartless)]]},["1o4yt4","1mb2nz","dlu2yg","z72bsq"]]);
