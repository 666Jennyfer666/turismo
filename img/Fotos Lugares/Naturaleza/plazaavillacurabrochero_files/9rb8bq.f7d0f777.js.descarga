(this.$WP=this.$WP||[]).push(["9rb8bq",(e,t)=>{"use strict";var a,r,i,n,o,l,s,d,c,p,u,v,T,S,m,C,b,E,h,g,f,k,I,y,A,_,M,O,P,R,j,L,w,N,D,x,V,F,q,U,z,W,G=(e,t)=>{var a,r,i;if(!t)return e;var n=(null==(a=e.paginatedTrips)?void 0:a.trips)||[],o=(null==(r=t.paginatedTrips)?void 0:r.trips)||[];return{paginatedTrips:e.paginatedTrips?{trips:[...n,...o],hasMore:!(null==(i=t.paginatedTrips)||!i.hasMore),__typename:e.paginatedTrips.__typename}:t.paginatedTrips,savedTrips:e.savedTrips}},B=e=>{var t;return{__typename:e.__typename,id:e.id||0,title:e.title||void 0,status:e.status||void 0,photoId:e.photoId||void 0,photo:e.photo||{},route:{url:e.route&&e.route.url||void 0},actionPermissions:{canAddItem:!(null==(t=e.actionPermissions)||!t.canAddItem)}}},Q=e=>{var t,a,r,i,n,o=(t,a)=>{if(!t||!a)return"invalidateAndRefetch";var{originalObject:r}=e;return r&&a===r.type&&t===String(r.id)||a===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"},l={offset:0,limit:10,userId:E()||"",reference:p(e),loadSavedTrips:!0},[s,d]=R({query:L,variables:l,combineData:G,showFetchingAfterFirstQuery:!0,invalidationPredicates:{createTrip:()=>"invalidateAndRefetch",cloneTrip:()=>"invalidateAndRefetch",tripsDelete:()=>"invalidateAndRefetch",addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>o(e,t),moveTripItem:({variables:{reference:e}})=>o(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveItem:({variables:{reference:e}})=>o(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveReference:({variables:{reference:e}})=>o(null==e?void 0:e.id,null==e?void 0:e.type)}}),c=(null==(t=s.data)||null==(a=t.paginatedTrips)?void 0:a.trips)||[],u=c.slice().filter(Boolean).map(B),v=!(null==(r=s.data)||null==(i=r.paginatedTrips)||!i.hasMore),T=(null==(n=s.data)?void 0:n.savedTrips)||[],S=new Set(T.map((e=>null==e?void 0:e.id)).filter(Boolean)),m=v?()=>d({offset:(null==c?void 0:c.length)||0,loadSavedTrips:!1}):()=>Promise.resolve();return{fetching:s.fetching,error:!!s.error,data:{tripList:u,saveSet:S,canMakePublicTrip:!0},hasMore:v,loadMore:m}},$="tvfpI Fn f u j",X="RyNfJ",Y={DEFAULT:e=>w(_,"bundleSave"!==e?{id:"stat_modal_save_to_trip_v2"}:{id:"save_all_items_modal_header"}),CREATE:()=>w(_,{id:"stat_modal_create_a_trip_v2"}),SELECT:()=>w(_,{id:"select_trip_header"}),SELECT_CREATE:()=>w(_,{id:"stat_modal_create_a_trip_v2"})},H=()=>w("div",{className:$,children:w(A,{size:"large"})}),J=({saveObject:e,overlayState:t,validateTripName:a,lastSavedItem:o,trackingContext:s,trackingSource:d,...c})=>{var p,[v,T]=r(!0),{fetching:S,error:m,data:C,hasMore:b,loadMore:E}=N(e);S?p=w(A,{size:"large"}):m&&(p=w(O,{refetch:E}));var h="gaiTrip"===e.type,g=h?"COPY":"SAVE";i((()=>{S||T(!1)}),[]);var[f]=l({source:d||"trips",trackingContext:s,pageAsContext:!0,withSaveSession:!0}),_=()=>{c.onClose(),T(!0)},R=Y[t](e.type),j=w(I,{icon:y,displayType:"LEFT_ALIGN_GRAY",children:R});return w(M,{element:"bundleSave"===e.type?"copyTripModal":"saveTripModal",children:w(k,{header:j,closeIconColor:"BLACK",bodyProps:{isFullBleed:!0},onClose:_,children:p&&v?w("div",{className:$,children:p}):(()=>{var r=o?u(o):void 0,i=()=>w("div",{className:X,children:w(P,h?{children:w(n,{fallback:w(H,{}),children:w(V,{gate:()=>Promise.resolve(),object:e,onMount:()=>{S||m||f({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:e=>{c.statCallback("ADD","NEW",e,!0,!0),_()},canMakePublicTrip:C.canMakePublicTrip,validateTripName:a,trackingContext:s,trackingSource:d})})}:{children:w(n,{fallback:w(H,{}),children:w(D,{gate:()=>Promise.resolve(),object:e,onMount:()=>{S||m||f({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:e=>{c.statCallback("ADD","NEW",e,!0,!0),_()},onError:c.onError,canMakePublicTrip:C.canMakePublicTrip,validateTripName:a,trackingContext:s,trackingSource:d})})})});switch(t){case"DEFAULT":return 0===C.tripList.length?i():w(P,{children:w(n,{fallback:w(H,{}),children:w(F,{tripList:C.tripList,savedSet:C.saveSet,tripListBottom:p,onPaginate:E,hasMore:b,saveObject:e,onMount:()=>{c.preventInteractionInMountedComponents||f({elementClick:{element:"stat"}})},onCreateTrip:()=>{c.onCreateTripClicked&&c.onCreateTripClicked()},tripAction:g,onRemovedFromTrip:(e,t,a)=>{c.statCallback("REMOVE","EXISTING",e,t,a),_()},onSavedToTrip:(e,t,a)=>{c.statCallback("ADD","EXISTING",e,t,a),_()},onError:c.onError,trackingContext:s,trackingSource:d})})});case"CREATE":return i();case"SELECT":return r?w(P,{children:w(n,{fallback:w(H,{}),children:w(F,{tripList:C.tripList,savedSet:C.saveSet,tripListBottom:p,onPaginate:E,hasMore:b,saveObject:r,onMount:()=>{f({elementClick:{element:"stat"}})},onCreateTrip:()=>{c.onSelectCreateTripClicked&&c.onSelectCreateTripClicked()},tripAction:"MOVE",onMovedToTrip:(e,t,a)=>{c.statCallback("MOVE","EXISTING",e,t,a),_()},onRemovedFromTrip:(e,t,a)=>{c.statCallback("REMOVE","EXISTING",e,t,a),_()},onError:c.onError,trackingContext:s,trackingSource:d})})}):"";case"SELECT_CREATE":return o?w("div",{className:X,children:w(P,{children:w(n,{fallback:w(H,{}),children:w(x,{gate:()=>Promise.resolve(),item:o,onMovedToCreatedTrip:e=>{c.statCallback("MOVE","NEW",e,!0,!0),_()},canMakePublicTrip:C.canMakePublicTrip})})})}):i();default:return""}})()})})},K=e=>{},Z=(e,t)=>{var a;switch(t.type){case"setOverlayState":return{...e,overlayState:null!=(a=t.state)?a:e.overlayState};case"afterSave":return{...e,overlayState:"DEFAULT",preventInteractionInMountedComponents:!0};default:throw new Error}},ee=({allowPopStatModal:e,logInteraction:t,puid:r,object:i,active:n,preventInteractionPropagation:o,trackingContext:l,trackingSource:s,resaveTrip:c,saveObject:p,saveStatus:u,updateLastTripId:v,onClose:S,initialOverlayState:m,...C})=>{var b,f=E(),{launchViewTripToast:k,launchRemoveFromTripToast:I,launchErrorTripToast:y}=T(),{getTripErrorMessage:A}=h(),_=g("SAVE_TO_TRIP_INTENT"),M=g("SAVE_TO_TRIP"),O=g({type:"CREATE_TRIP",payload:{user_id:f||""}}),P=a.useContext(d),[R,j]=a.useReducer(Z,{overlayState:m||"DEFAULT",preventInteractionInMountedComponents:!1}),{onComplete:L}=C,N=a.useCallback((e=>{L&&L(e),P.resetSession()}),[L,P]),D=a.useCallback(((e,a)=>{e&&!a?(k(e,"SAVED",(()=>{t({elementClick:{element:"saved_viewTrip"}})})),N(!0)):a&&(y(a),N(!1)),j({type:"setOverlayState",state:"DEFAULT"}),t({elementClick:{element:"unsave_undo"}})}),[k,N,y,t]),x=a.useCallback((e=>{I(e,p,D)}),[I,D,p]),V=a.useCallback((e=>{y(e)}),[y]),[F,U]=a.useState(!1),z=a.useCallback((()=>{U(!0),P.resetSession()}),[P]),W=a.useCallback(((e,a)=>{"CREATED"===a&&(M(),O()),j({type:"afterSave"}),k(e,a,(()=>{t({elementClick:{element:"saved_viewTrip"}})})),v(e.id),N(!0)}),[M,k,N,v,O,t]);return F?null:w("div",{className:"stat_wrapper",onClick:e=>{e.stopPropagation(),e.preventDefault(),!o&&f&&t({elementClick:{element:"item_save",tripId:null==c?void 0:c.id}}),n||_()},children:w(q,{saveObject:p,overlayState:R.overlayState,lastSavedItem:null==(b=u.result)?void 0:b.tripItem,trackingContext:l,trackingSource:s,onCreateTripClicked:()=>{j({type:"setOverlayState",state:"CREATE"})},onSelectCreateTripClicked:()=>{j({type:"setOverlayState",state:"SELECT_CREATE"})},onClose:z,onError:V,preventInteractionInMountedComponents:R.preventInteractionInMountedComponents,statCallback:(e,t,a,r,i=!1)=>{a&&"id"in a&&("REMOVE"===e?(x(a),N(i)):"NEW"===t?W(a,"CREATED"):r&&W(a,"SAVED"))},validateTripName:e=>{if("bundleSave"===p.type&&e.trim().toLowerCase()===i.title.trim().toLowerCase())return A("COPY_TRIP",{type:"INVALID_VALUE",field:"TITLE"})}})})},te=e=>w(s,{children:w(f,{children:w(ee,{...e})})}),ae=["Profile","HomeFeed","Trips","Home"],re=e=>{var t=a.useMemo((()=>e.saveObject||u(e.object,!0)),[e.saveObject,e.object]),{resaveTrip:r,onComplete:i,allowPopStatModal:n,flowOrigin:o}=e,{isNativeWebview:s,tripId:p,...v}=e,{launchAutoSavedToTripToast:E,launchErrorTripToast:h}=T(),g=S(),{page:f}=g,k=a.useMemo((()=>({source:e.trackingSource||"trips",saveObject:t,trackingContext:e.trackingContext,withSaveSession:!0,pageAsContext:!0})),[e.trackingContext,e.trackingSource,t]),[I,y]=l(k),A=a.useContext(d),[_,M,O]=m(p,t,e.active),P=null==t?void 0:t.id,R=null==t?void 0:t.type,j=a.useCallback((e=>{h(e)}),[h]),L=a.useCallback((()=>{I({elementClick:{element:"ITEM_SAVE_LOGIN",context:f&&c(f)||void 0,puid:y,saveType:R,detailId:P?`${P}`:"",tripId:null==r?void 0:r.id,sessionType:"SAVE",sessionUuid:A.sessionUuid,sessionOrder:A.sessionOrder}})}),[I,f,y,r,P,R,A.sessionOrder,A.sessionUuid]),N=a.useCallback((()=>{I({modalSuccess:{element:"ITEM_SAVE_LOGIN",context:f&&c(f)||void 0,puid:y,saveType:R,detailId:P?`${P}`:"",tripId:null==r?void 0:r.id,sessionType:"SAVE",sessionUuid:A.sessionUuid,sessionOrder:A.sessionOrder}})}),[I,f,y,r,P,R,A.sessionOrder,A.sessionUuid]),D=a.useMemo((()=>({pid:f&&ae.includes(g.page)?40439:39766,flow:s?"NATIVE_LOGIN":"SAVES_COMBINED",flowOrigin:o,onLogin:L,onSuccess:N,isFullWidthMobile:!0})),[L,N,f,g.page,s,o]),x=C(D),V=a.useRef(!1),{open:F}=b((()=>t?w(U,{...v,logInteraction:I,puid:y,saveObject:t,saveStatus:_,updateLastTripId:O}):null)),{open:q}=b((()=>t?w(U,{...v,initialOverlayState:"SELECT",logInteraction:I,puid:y,saveObject:t,saveStatus:_,updateLastTripId:O}):null)),z=!!n&&"popStat"in g.params&&g.params.popStat;return a.useEffect((()=>{z&&!V.current&&(V.current=!0,I({elementClick:{element:"autoPopStat"}}),x().then(F))}),[I,x,F,z]),a.useCallback((()=>{x().then((()=>M())).then((([e,t])=>{null!==e||null!==t?t?j({query:"ADD_ITEM_TO_TRIP",tripsError:t}):e&&(E(e,(()=>{q(),I({elementClick:{element:"quickSave_change"}})})),I({modalSuccess:{element:"quickSave",tripId:null==r?void 0:r.id,context:f&&c(f)||void 0,saveType:R,detailId:P?`${P}`:""}}),i&&i(!0)):F()}))}),[F,q,E,I,x,i,j,M,f,r,P,R])},ie=({children:e,...t})=>{var r=a.useMemo((()=>t.saveObject||u(t.object,!0)),[t.saveObject,t.object]),i=z(t);return r?w(s,{children:e(i)}):null},ne=({queryObject:e,object:t,children:a,...r})=>{var i,n,o,l;function s(t,a){if(!t||!a)return"invalidateAndRefetch";var{originalObject:r}=e;return r&&a===r.type&&t===String(r.id)||a===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"}var d=E(),[{fetching:c,data:p}]=j({query:e.query,variables:e.variables,pause:!d},{addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>s(e,t),tripsRemoveItem:({variables:{reference:e}})=>s(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveReference:({variables:{reference:e}})=>s(e.id,null==e?void 0:e.type)}),{id:u,socialStatistics:v}=null!=(i=null!=(n=null!=(o=null==p||null==(l=p.savesObjects)?void 0:l[0])?o:null==t?void 0:t.object)?n:t)?i:{},T=!1;return void 0!==u&&u!==e.id&&String(u)!==e.id||(T=!(null==v||!v.isSaved)),w(W,{active:T,object:t,...r,children:e=>a(e,T,c)})},oe=e=>{var t=e.saveObject||u(e.object,!0);if(!t)return console.error("An invalid saves object was passed to QueriedTripFlowSelector"),null;var a=v(t);return a?w(ne,{...e,queryObject:a}):(console.error("Unsupported saves object was passed to QueriedTripFlowSelector"),null)};return[()=>{N=Q,D=o((()=>t("5kzfzt").then((e=>({default:e.CreateTripWithAddItemModal}))))),x=o((()=>t("5kzfzt").then((e=>({default:e.CreateTripWithMoveItemModal}))))),V=o((()=>t("5kzfzt").then((e=>({default:e.CloneTripWithAddItemModal}))))),F=o((()=>t("an5ymg").then((e=>({default:e.SaveToTripContent}))))),q=J,ee.defaultProps={preventInteractionPropagation:!1,onComplete:void 0,trackingContext:void 0,allowPopStatModal:!1},U=te,z=re,W=ie,oe.defaultProps={object:null,trackingContext:void 0,allowPopStatModal:!1},e({QueriedTripFlowSelector:oe,STATModal:q,TripFlowSelector:W,setSTATDisabledForTesting:K,useSTATModal:z})},[e=>(a=e,r=e.useState,i=e.useEffect,n=e.Suspense,o=e.lazy),e=>(l=e.useTripInteraction,s=e.SaveSessionProvider,d=e.SaveSessionTrackingContext,c=e.getInteractionsContext),e=>(p=e.toReference,u=e.toSavesObject,v=e.objectStatisticQuery),e=>T=e.default,e=>S=e.useRoute,e=>m=e.useAutosave,e=>C=e.useSocialLoginGate,e=>b=e.useVDOMPortal,e=>E=e.useUserId,e=>h=e.useLocalizeTripError,e=>g=e.usePixelCallback,e=>f=e.ToastProvider,e=>k=e.default,e=>I=e.TitleBar,e=>y=e.default,e=>A=e.LoadingSpinner,e=>_=e.default,e=>M=e.TripsImpression,e=>O=e.default,e=>P=e.ErrorBoundary,e=>(R=e.usePaginatedQuery,j=e.useInvalidatableQuery),e=>L=e.TripDetailStatQuery,e=>w=e.jsx]]},["1o4yt4","1k7dpq","1iyqcw","12wscm","fgwvq1","1uw9rn","10506z","14euae","52far5","mc5s4b","1emwhd","tr3542","17u7gi","cnyhjq","1l75rc","1l9qeu","17thqz","665v5s","qhcore","183pm0","1fbuhs","ag9b0s","121h32"]]);
