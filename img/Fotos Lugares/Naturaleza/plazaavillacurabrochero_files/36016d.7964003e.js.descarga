(this.$WP=this.$WP||[]).push(["36016d",(e,o)=>{"use strict";var r,t,i,n,a,s,u,l,d,c,p,m,_,g,C,E,v,h,f,D,y=()=>{var{localize:e}=p();return r((o=>{switch(o){case"REJECTED_INACTIVE":return e.string("plus_checkout_promo_code_expired");case"REJECTED_CONNECTION_ERROR":return e.string("plus_checkout_promo_code_error");case"REJECTED_INVALID_USER":return e.string("plus_checkout_promo_code_unauthorized");case"REJECTED_ALREADY_USED":return e.string("plus_checkout_promo_code_used");default:return e.string("plus_checkout_promo_code_invalid")}}),[e])},P=({formFieldPrefix:e="pc",...o})=>{var{localize:d}=p(),{promoCodeForm:m,updatePromoCodeForm:h}=t(l),{appliedPromoCode:f,displayState:y,errorText:A,isApplying:T,promoCodeField:R}=m,b=D(),x=_(),O=r((()=>{x({OptimusDiscountCode:{optimusAction:{pageAction:"click",pageProperty:"promocode_link"}}}),h({displayState:"ShowPromoCodes"})}),[h,x]),I=r((e=>h({promoCodeField:{...R,value:e.toUpperCase()}})),[R,h]),k=r((()=>{x({OptimusDiscountCode:{optimusAction:{pageAction:"click",pageProperty:"promocode_apply",discountCode:R.value}}}),h({isApplying:!0})}),[h,x,R]),N=r((e=>{x({OptimusDiscountCode:{optimusAction:{pageAction:"in_view",pageProperty:"promocode_error",attribute:e}}})}),[x]),{subscriptionPrice:S}=P.useOptimusSubscriptionPrice("CHECKOUT"),{discount:F}=S||{};i((()=>{if(m.isApplying&&null!=F&&F.discountCode){var{discountCode:e,discountedPrice:o,originalPrice:r,status:t}=F;if("APPLIED"===t)h({appliedPromoCode:{amount:o-r,code:e,appliedPrice:S},isApplying:!1,promoCodeField:{...m.promoCodeField,isError:!1,value:""}});else{var i=b(t);h({appliedPromoCode:null,errorText:i,isApplying:!1,promoCodeField:{...m.promoCodeField,isError:!0,value:e}})}}}),[b,m,F,h,S]);var w=r((e=>b("REJECTED_CONNECTION_ERROR")===e?"connection_error":b("REJECTED_DISCOUNT_SERVICE_ERROR")===e?"invalid_code":b("REJECTED_INVALID_USER")===e?"unauthorized":b("REJECTED_ALREADY_USED")===e?"already_used":b("REJECTED_INACTIVE")===e?"cancelled_expired":""),[b]);return i((()=>{if(R.isError&&A){x({OptimusDiscountCode:{optimusAction:{pageAction:"failed",pageProperty:"promocode"}}});var e=w(A);N(e)}}),[R,A,x,w,N]),C(s,{...o,children:E(u,{dividers:!0,space:"spacing-03",children:[C(v,{}),"ShowPromoCodes"===y&&!f&&E(s,{display:"flex",className:"vhdxv O f",children:[C(g,{errorText:R.isError?A:void 0,id:`${e}-promoCodeInput`,marginRight:"spacing-03",onChange:e=>I(e.currentTarget.value),placeholder:d.string("plus_checkout_promo_code_placeholder"),state:R.isError?"error":"enabled",type:"text",value:R.value}),C(n,{dataAttributes:{"data-automation":"applyDiscount"},disabled:T,onClick:()=>R.value&&k(),variant:"secondary",children:C(c,{id:"plus_checkout_promo_code_apply"})})]}),"ShowLink"===y&&C(s,{marginY:"spacing-03",children:C(a,{dataAttributes:{"data-automation":"showDiscountInput"},onClick:O,children:C(c,{id:"plus_checkout_promo_code"})})})]})})};function A(e,o){var i=_(),{updatePromoCodeForm:n}=t(l),a=m(),{localize:s}=p(),u=m(),d=r((()=>{i({OptimusDiscountCode:{optimusAction:{pageAction:"success",pageProperty:"promocode"}}})}),[i]),c=null==e?void 0:e.discountCode;if(!e||!c)return null;var g=a.formatCurrencyInteger(e.originalPrice),C=e.discountedPrice-e.originalPrice,{expiryDate:E}=e,v=E?u.formatDate("date_short",new Date(E)):null,h=o?s.string("plus_partner_discount_tooltip",{0:o}):s.string("plus_first_year_discount_title"),f=`${s.string("plus_first_year_discount_body",{originalPrice:g})}\n  ${v?s.string("plus_discount_expire_date",{expireDate:v}):""}`;return{onRemove:()=>n({appliedPromoCode:null}),price:C,rawPrice:C,title:c,...e.discountedPrice>0?{tooltipTitle:h,tooltipBody:f}:null,variant:"DISCOUNT",onRemoveVisible:d}}var T=()=>{var e="discountCode";return{setDiscountCode:o=>{h.set(e,o,864e5)},getDiscountCode:()=>h.get(e),clearDiscountCode:()=>{h.remove(e)}}},R={__key:0x914b16b5e13b,id:"914b16b5e13b0458b85a224ce2095d7f",loc:{},definitions:[]},b={TARGET:{img:"/img2/plus/plus-partner-logo-target.svg",altText:"Target logo"},ACORNS:{img:"/img2/plus/plus-partner-logo-acorns.svg",altText:"Acorns"},CLEAR:{img:"/img2/plus/plus-partner-logo-clear.svg",altText:"Clear"}},x=(e,o)=>{var r,t,i,n,a=o||!e,[{data:s,fetching:u,error:l}]=f({query:R,variables:{discountCode:e},pause:a});if(a)return{partnerName:null,partnerLogo:null,entitlement:null,fetching:!1,error:void 0};var d=null==s||null==(r=s.partnerEntitlement)?void 0:r.partnerName;return{partnerName:d?null==(t=b[d])?void 0:t.altText:void 0,partnerLogo:d?null==(i=b[d])?void 0:i.img:void 0,entitlement:null==s||null==(n=s.partnerEntitlement)?void 0:n.entitlement,error:l,fetching:u}},O={__key:0x7a1b57213480,id:"7a1b572134800fd87f99ec5a89f784f0",loc:{},definitions:[]},I=e=>{var o,[{data:r,fetching:t,error:i}]=f({query:O,variables:{discountCode:e},pause:!e});if(!e)return{data:null,fetching:!1};if(i)throw new TypeError(i.message);return{data:(null==r||null==(o=r.OptimusBenefits_getTermsAndConditionsForDiscountCode)?void 0:o[0])||null,fetching:t}};return e("useDiscountCharge",A),[()=>{D=y,P.useOptimusSubscriptionPrice=d,e({default:P,useDiscountCharge:A,useDiscountCodePersistance:T,useOptimusEntitlement:x,useTermsAndConditionsForDiscountCode:I})},[e=>(r=e.useCallback,t=e.useContext,i=e.useEffect),e=>(n=e.default,a=e.BorderlessButton),e=>(s=e.Box,u=e.Stack),e=>l=e.Payment,e=>d=e.useOptimusSubscriptionPrice,e=>(c=e.default,p=e.useLocalize,m=e.useIntlFormatter),e=>_=e.useInteractionLogger,e=>g=e.TextInput,e=>(C=e.jsx,E=e.jsxs,v=e.Fragment),e=>h=e.default,e=>f=e.useQuery]]},["1o4yt4","jppfwt","lyyh8d","1yajq4","i9ixrv","17thqz","32pwc7","1u3aio","121h32","19b9b1","1mqwhq"]]);
