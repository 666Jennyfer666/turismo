(this.$WP=this.$WP||[]).push(["16dusp",(e,t)=>{"use strict";var r,a,n,i,l,o,s,u,g,v,m,p,d,c,S,y,f,I,b,h,k,T,w,P,x,E,N,V,O,F,D,M,C,L,A,B,R,U=(e,t,r)=>{var a={...e.current};a[t]=[...new Set([...a[t]||[],r])],e.current=a},K=[],G=e=>{var{fetching:t,isEligible:r}=E("interstitial",{logImpression:!0});return t?null:r?"trip-text":(U(e,"tripText","notEligibleEntrypoint"),"")},J=({delayed:e,children:t})=>T(O.Provider,{value:e,children:t}),W="interstitialData",_=e=>e?new Map(JSON.parse(e)):new Map,j=(e,t,r)=>{var a=_(e).get(t),n=(new Date).getTime();return a&&(null==a?void 0:a.find((e=>e.key===r&&(!e.ttl||e.ttl>=n))))||null},q=(e,t,r,a)=>{var n;return((null==(n=j(e,t,r))?void 0:n.value)||a)+0},z=(e,t,r,a)=>{var n,i;return!!(null!=(n=null==(i=j(e,t,r))?void 0:i.value)?n:a)},$=(e,t,r)=>{var a,n=e.get(t),i=(new Date).getTime();n=(null==(a=n)?void 0:a.filter((e=>e.key!==r.key&&(!e.ttl||e.ttl>=i))))||[];var l=r;return l.ttl&&(l.ttl+=i),n.push(l),e.set(t,n),e},X=(e,t,r,a)=>{var n=_(I.get(W)||"");$(n,e,{key:t,value:r,ttl:a}),I.set(W,JSON.stringify(Array.from(n.entries())))},H=(e,t,r)=>{var a=_(b.get(W)||"");$(a,e,{key:t,value:r}),b.set(W,JSON.stringify(Array.from(a.entries())))},Q=/^https?:\/\/[a-z\-\.0-9]+\.tripadvisor(-preview)?\.[a-z\-\.]+/,Y=e=>{var[t,r]=a(e);return n((()=>{r(!Q.test(document.referrer))}),[]),t},Z="pageViews",ee="delayPageViews",te="sessionPreviouslySeenCounter",re="sessionPreviouslySeenGhost",ae="previouslySeenInterval",ne="previouslySeenTotal",ie="previouslySeenIntervalGhost",le="previouslySeenTotalGhost",oe="IneligibilityLogged",se="interstitialData",ue=({children:e,onShow:t,onControlWouldShow:r,delaySeconds:s,delayPageViews:u,afterPageViews:g,maxSeen:v,maxSeenSession:c,campaignInfo:f,isDatePickerOpen:w,suppress:P,suppressWhenDelayed:x,ignoreInterval:E,onSkip:N,fallback:V=null,isControl:O=!1})=>{var{campaignName:A,variant:B}=f,[R,K]=a(!1),[G,J]=a(""),[W,_]=a("");n((()=>{K(!0),J(I.get(se)),_(b.get(se))}),[]);var j=i((()=>D.getNumberFromStorage(G,A,Z,0)),[G,A]),q=i((()=>D.getNumberFromStorage(G,A,ee,0)),[G,A]),z=i((()=>D.getBooleanFromStorage(G,A,ae,!1)),[G,A]),$=i((()=>D.getNumberFromStorage(G,A,ne,0)),[G,A]),X=i((()=>D.getNumberFromStorage(W,A,te,0)),[W,A]),H=i((()=>D.getBooleanFromStorage(G,A,ie,!1)),[G,A]),Q=i((()=>D.getNumberFromStorage(G,A,le,0)),[G,A]),Y=i((()=>D.getNumberFromStorage(W,A,re,0)),[W,A]),ue=l({}),[ge,ve]=a(!1),{funnelKey:me}=o(y),{page:pe}=p(),de=d(),ce=m(),Se=S(),ye=h(),fe=k();n((()=>{R&&(!E&&z||D.saveValueToLocalStorage(A,Z,j+1,L))}),[A,j,z,E,R]);var Ie=M.useIsExternalReferrer(!0),be=!!Ie&&q<u,he=P||be&&x;n((()=>{(he||w)&&ve(!1)}),[he,w]);var ke=i((()=>!w&&j>=g&&(E||!z)&&$<v&&X<c),[w,j,g,z,$,X,v,c,E]);return n((()=>{R&&(ke&&!he||!N||N())}),[R,ke,he,N]),n((()=>{if(!R)return()=>{};var e=D.getBooleanFromStorage(G,A,oe,!1);if(ke){be&&!x&&D.saveValueToLocalStorage(A,ee,q+1,L);var a=()=>{document.querySelector('[title="regcontroller"]')||document.getElementById("explicitPreferences")||((E||!H)&&Y<c&&Q<v&&ke&&!w&&(ye({optimusMarketingInterstitial:{name:O?`control_${B}`:B,pageviewUid:de}}),O&&(r&&r(),D.saveValueToSessionStorage(A,re,Y+1),D.saveValueToLocalStorage(A,ie,!0,C),D.saveValueToLocalStorage(A,le,Q+1,L))),he||!ke||w||(D.saveValueToSessionStorage(A,te,X+1),D.saveValueToLocalStorage(A,ae,!0,C),D.saveValueToLocalStorage(A,ne,$+1,L),ve(!0),t&&t()))};if(be&&!x&&!O){var n=setTimeout(a,1e3*s);return()=>clearTimeout(n)}a()}else e||(j<g&&U(ue,"common","notEnoughPageViews"),z&&!E&&U(ue,"common","seenMaxInterval"),X>=c&&U(ue,"common","seenMaxSession"),$>=v&&U(ue,"common","seenMaxOverall"),Object.keys(ue.current).length>0&&(D.saveValueToLocalStorage(A,oe,!0,C),fe({externalKey:me,itemName:"Ineligibility",itemType:"OptimusMarketingInterstitial",page:pe,pageUid:de,sessionId:ce,team:"Plus",userId:Se,customData:JSON.stringify({...ue.current})})));return()=>{}}),[ke,Ie,ve,s,u,q,X,Y,$,Q,H,v,c,w,t,he,ye,de,B,O,E,fe,me,pe,ce,Se,ue,j,g,z,A,G,be,r,x,R]),T(F,{delayed:be,children:ge?e:V})},ge=e=>{var t=N();return"preDatePicker"===e&&!t},ve=({delaySeconds:e=30,afterPageViews:t=0,delayPageViews:r=1,maxSeen:i=3,maxSeenSession:u=1,isDatePickerOpen:v,onPopupDismiss:f,onOpen:I,onClose:b,fallback:h=null,popupOrder:E})=>{var N=l({}),[O,F]=a(null),{isOptimusEnabled:D,isOptimusSubscribed:M}=P(),{page:C}=p(),L=d(),G=(e=>{var t=V(e);return null===t?null:t?{campaignName:"tripText",variant:t}:{campaignName:"",variant:""}})(N),J=(()=>{var{page:e,params:t}=p(),r=t.discountCode||null,a=!("Plus"!==e||!t.autopop&&""!==t.autopop||!r),n="Plus"===e&&null!==t.autopop&&"SUMMER0"===t.autopop;return a||n})(),W=(()=>{var e=S(),t=w({experimentKeys:K,userId:e||void 0,skipImpression:!0});return null===t?null:Object.keys(t).length>0})(),_=k(),{funnelKey:j}=o(y),q=m(),z=S(),$="MOBILE"===c();n((()=>{null===O&&F(G)}),[j,_,G,D,M,C,L,O,q,z]),n((()=>{null!==O&&(M&&U(N,"common","alreadySubscribed"),W&&Object.keys(N.current).length>0&&_({externalKey:j,itemName:"Ineligibility",itemType:"OptimusMarketingInterstitial",page:C,pageUid:L,sessionId:q,team:"Plus",userId:z,customData:JSON.stringify({...N.current})}))}),[j,_,W,$,M,C,L,O,q,z]);var X=g((()=>{b&&b(),f&&f()}),[b,f]),H=null===O||null===W,Q=(M||!(null!=O&&O.variant))&&!H;n((()=>{Q&&f&&f()}),[Q,f]);var Y=B(E);if(H)return null;if(Q)return h;var Z=(({variant:e,onInterstitialClose:t})=>{var r=(({variant:e,onInterstitialClose:t})=>{if("trip-text"!==e)throw new Error(`Education interstitial not implemented for variant ${e}`);return T(R,{variant:e,onClose:()=>t(),dataAutomationTag:"plusMarketingInterstitial"})})({variant:e,onInterstitialClose:t});return T(x,{children:T(s,{children:r})})})({variant:O.variant,onInterstitialClose:X}),ee=i,te=u;return J&&(ee=Number.MAX_SAFE_INTEGER,te=Number.MAX_SAFE_INTEGER),T(A,{delaySeconds:e,delayPageViews:J?0:r,afterPageViews:t,maxSeen:ee,maxSeenSession:te,campaignInfo:O,isDatePickerOpen:v,onSkip:f,ignoreInterval:J,onShow:I,fallback:h,suppressWhenDelayed:Y,children:Z})},me=e=>{var[t]=a(v());return T(f,{funnelKey:t,children:T(ve,{...e})})};return[()=>{V=G,O=r(!1),F=J,D={getNumberFromStorage:q,getBooleanFromStorage:z,saveValueToLocalStorage:X,saveValueToSessionStorage:H},M={useIsExternalReferrer:Y},L=14*(C=864e5),A=ue,B=ge,R=u((()=>t("1kfvtb"))),e("default",me)},[e=>(r=e.createContext,a=e.useState,n=e.useEffect,i=e.useMemo,l=e.useRef,o=e.useContext,s=e.Suspense,u=e.lazy,g=e.useCallback),e=>v=e.uuid,e=>m=e.useSessionId,e=>(p=e.useRoute,d=e.usePageviewUid),e=>c=e.useViewportCategory,e=>S=e.useUserId,e=>(y=e.FunnelTracking,f=e.FunnelTrackingProvider),e=>I=e.default,e=>b=e.default,e=>h=e.useImpressionLogger,e=>k=e.default,e=>T=e.jsx,e=>w=e.default,e=>P=e.useOptimusEnabledForUser,e=>x=e.ErrorBoundary,e=>E=e.useIsEntrypointEligibleForTextDemandTest,e=>N=e.useIsDated]]},["1o4yt4","1eww82","1al4vi","fgwvq1","1ys6v1","52far5","1kkqcv","19b9b1","tp1g68","1vumu0","xg719z","121h32","gugp1d","14tv4a","183pm0","1notq9","2tnrli"]]);
