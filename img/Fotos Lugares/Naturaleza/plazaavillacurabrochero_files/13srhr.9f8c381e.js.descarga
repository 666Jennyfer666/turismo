(this.$WP=this.$WP||[]).push(["13srhr",(e,t)=>{"use strict";var a,o,r,i,n,l,s,u,d,c,p,m,g,C,h,f,I,v,_,k,P,b,y,D,w,S,T,O,M,N,A,E,B,F,R,V,x,G,L,U,W,z,j,H="attractionsAbandonedCartPopupInfo",K={clearOutdatedStoredValues:()=>{var e=s.get(H);e&&!e.logicV2&&s.remove(H)},isPopupExpired:e=>{var t=s.get(H);if(!t)return!0;var a=t.lastSessionId!==e,o=Date.now()>t.timestamp+t.ttl;return a||o},tryResetDismissValue:()=>{var e=s.get(H);null!=e&&e.suppress&&Date.now()>e.timestamp+B&&K.updateCartInfoIsDismissed(!1)},shouldShowPopup:e=>{var t=s.get(H);return!t||!t.suppress||!$(t.cartProductInfo,e)},buildCartProductInfo:e=>e.map((e=>JSON.stringify({productCode:e.productCode,tourGradeCode:e.tourGradeCode,tourDate:e.tourDate,passengerMix:e.passengerMix}))),setCartInfoWithProductReset:(e,t,a)=>{if(null!=e&&""!==e){var o={lastSessionId:e,suppress:t,cartProductInfo:a,timestamp:Date.now(),ttl:E,logicV2:!0};s.set(H,o,F)}},setCartInfoWithProductAdd:(e,t,a)=>{if(null!=e&&""!==e){var o=s.get(H),r=(null==o?void 0:o.cartProductInfo)||[];""!==a&&r.push(a);var i={lastSessionId:e,suppress:t,cartProductInfo:r,timestamp:Date.now(),ttl:E,logicV2:!0};s.set(H,i,F)}},resetCartInfoWithNewTimestamp:(e,t)=>{if(null!=e&&""!==e){var a=s.get(H);K.setCartInfoWithProductReset(e,t,(null==a?void 0:a.cartProductInfo)||[])}},updateCartInfoIsDismissed:e=>{var t=s.get(H);if(null!=t){var a={...t,suppress:e};s.set(H,a,F)}}},$=(e,t)=>{if(!e&&!t)return!0;if(!e||!t)return!1;var a=new Set(e),o=new Set(t);if(a.size!==o.size)return!1;var r=!0;return a.forEach((e=>{o.has(e)||(r=!1)})),r},q="attractionsCheckoutPopUpInfo",J={isPopupExpired:e=>{var t=s.get(q);return!t||t.lastSessionId!==e||Date.now()>t.timestamp+t.ttl},clearOutdatedStoredValues:()=>{var e=s.get(q);e&&!e.logicV2&&s.remove(q)},tryResetDismissValue:()=>{var e=s.get(q);null!=e&&e.popupInfo&&Date.now()>(null==e?void 0:e.timestamp)+V&&J.updateCheckoutInfoIsDismissed(!1)},shouldShowPopup:e=>{var t=s.get(q);return null==t||!t.popupInfo||(null==t?void 0:t.popupInfo.productCode)!==e.productCode||(null==t?void 0:t.popupInfo.tourGradeCode)!==e.tourGradeCode||!(null!=t&&t.popupInfo.dismissed)},setCheckoutPopupInfo:(e,t,a,o)=>{if(e){var r="string"==typeof t?t:t.originalValue||t.encodedValue&&u(t.encodedValue);if(r){var i={lastSessionId:e,popupInfo:{productCode:r,tourGradeCode:a,dismissed:o},timestamp:Date.now(),ttl:R,logicV2:!0};s.set(q,i,x)}}},updateCheckoutInfoIsDismissed:e=>{var t=s.get(q),a=t&&t.popupInfo;if(t&&a){var o={productCode:a.productCode,tourGradeCode:a.tourGradeCode,dismissed:e},r={...t,lastSessionId:t.lastSessionId,popupInfo:o};s.set(q,r,x)}}},Q=()=>{var e=s.get(H),t=s.get(q);return e||t?e&&t?e.timestamp>t.timestamp?"CART":"CHECKOUT":e?"CHECKOUT":"CART":"CHECKOUT"},Y=({checkout:e,cart:t})=>{var{status:o,data:r}=(({runQuery:e})=>c({runQuery:e,checkout:!0}))({runQuery:e}),{status:i,data:n}=(({runQuery:e})=>c({runQuery:e,checkout:!1}))({runQuery:t}),{clickOffTest:l}=d(),{isFetching:s,isInTest:u}=l;return a((()=>{}),[r,n,i,o]),"Fetching"===o||"Fetching"===i||s||u?{checkoutItem:null,cartItems:null}:{checkoutItem:null!=r&&r.length>0?r[0]:null,cartItems:null!=n&&n.length>0?n:null}},X=(e,t)=>{var a=e.length,o=e.reduce(((e,t)=>e+t.price||0),0);return JSON.stringify({gbv:o,cur:t,ni:a})},Z=e=>e.some((e=>null==e?void 0:e.likelyToSellOut)),ee=({numberItems:e})=>S(h,e>1?{id:"sng_adventures_await"}:{id:"experiences_your_adventure_awaits"}),te=({viewDetailsButton:e,continueButton:t})=>w("div",{className:"f F Pk PY Px PK",children:[e,t]}),ae=({numItems:e,showLTSODisclaimer:t,productContent:a,continueButton:o,viewDetailsButton:r,onModalClose:i,onModalVisibility:n})=>{var l="MOBILE"===m(),s=D((()=>{n()})),u=w("div",{ref:s,className:"CUSoI","data-automation":"TTDAbandonedCartModal",children:[S("div",{className:"Gjukv f e",children:a}),t&&S("div",{className:"WftyJ",children:S(y,{variant:"supporting-02",children:S(h,{id:"attractions_ltso_disclaimer_text_bottom"})})})]});return l?S(b,{mobileContainerStyle:"inset",mobileInsetHeight:"fixed",title:S(ee,{numberItems:e}),onClose:i,stickyFooter:S(te,{continueButton:o,viewDetailsButton:r}),children:u}):S(P,{variant:"fixed-height-sticky-footer",heightOption:"restricted",title:S(ee,{numberItems:e}),footer:S(te,{continueButton:o,viewDetailsButton:r}),onClose:i,children:u})},oe=({cancellationCondition:e,onDisplay:t})=>(a((()=>{null==t||t()})),w("div",{className:"f",children:[S(M,{marginRight:"spacing-01"}),e]})),re=({productItemData:e,onClick:t=(()=>{}),onCancellationMessageDisplay:a})=>{var o="MOBILE"===m(),r=w(T,{children:[S("div",{dangerouslySetInnerHTML:{__html:e.tourGradeName}}),S("div",{className:"Ph",children:e.tourDate})]}),i=null==e.cancellationCondition||o?void 0:S(oe,{cancellationCondition:e.cancellationCondition,onDisplay:()=>null==a?void 0:a(e)}),n=w(T,{children:[e.passengerMix.map((e=>S(y,{variant:"supporting-01",marginBottom:"spacing-01",children:S(N,{ageBand:e})},e.bandId))),e.priceFormatted]});return S(O,{title:e.productName,primaryInfo:r,secondaryInfo:i,merchandisingText:n,labels:_({...e.labelData}),rating:e.rating,reviewCount:e.numReviews,url:e.productUrl,thumbnail:e.imageUrl,onClick:t,enforceMaxImageSize:!0,height:o?70:130,width:o?70:130})},ie=({productItems:e,onClose:t,onCancellationMessageDisplay:a})=>{var r="MOBILE"===m(),i=k(),s=f(),u=g(),d=C(),{page:c}=l(),h=n(),v=Z(e),_=X(e,s),P="abandonedCartModule",b=o(((e,t)=>{u({actionType:"click",team:"Attractions",itemName:e,itemGroup:P,customData:t||_,page:c})}),[P,_,u,c]);return S(ae,{numItems:e.length,showLTSODisclaimer:v,onModalClose:()=>{K.resetCartInfoWithNewTimestamp(h,!0),J.updateCheckoutInfoIsDismissed(!0),t(),b("closeCartModule")},onModalVisibility:()=>{K.setCartInfoWithProductReset(h,!1,K.buildCartProductInfo(e)),d({team:"Attractions",itemName:"abandonedCartVisibleImpression",itemGroup:P,customData:_,page:c})},continueButton:S(p,{variant:"commerce",size:"small",href:i,onClick:()=>{b("viewCartAndCheckout_click")},fullWidth:r,children:S(I,{id:"view_cart_checkout"})}),productContent:e.map((e=>S(U,{productItemData:e,onClick:()=>(e=>{b("productItemClick",JSON.stringify({prc:e.priceFormatted,cur:s,apc:e.productCode,lid:e.locationId,sprc:e.strikeThroughPrice})),t()})(e),onCancellationMessageDisplay:a},e.tourGradeName)))})},ne="DEFAULT",le="UNABLE_TO_CHECK_AVAILABILITY",se="TOUR_SOLD_OUT_UNAVAILABLE",ue=({productCode:e,productName:t,date:a,ageBands:o,partnerName:r,locationId:i})=>new Promise(((n,l)=>{var s=new URLSearchParams;s.append("tourDate",a),s.append("attrdate",(e=>e.replace(/-/g,"_"))(a)),s.append("ageBands",Array.from(o).map((([e,t])=>`${e}:${t}`)).join(",")),s.append("locationId",JSON.stringify(i));var u=`/AttractionBookingApi/product/${r?`${r}/`:""}${e}/tour_grades?${s.toString()}`,d=e=>{fetch(u,{credentials:"same-origin"}).then((e=>{if(e.ok)return e.json();throw Error(e.statusText)})).then((a=>{if("COMPLETE"===a.polling_state){var o=a.tour_grades.map((e=>({gradeCode:e.grade_code,sortOrder:e.sort_order,rnplEligibility:{eligible:!!e.rnpl_eligibility&&e.rnpl_eligibility.eligible,ineligibilityReasons:e.rnpl_eligibility?e.rnpl_eligibility.ineligibility_reasons:[]},gradeTitle:ne===e.grade_title?t:e.grade_title,gradeDescription:ne===e.grade_title?"":e.grade_description,priceFormatted:e.price_formatted,maxTravelersPerUnit:e.max_travelers_per_unit,ageBandsDisplay:e.age_bands.map((e=>e.band_summary)),available:e.available,isMostPopularText:e.is_most_popular_text,langServices:null!==e.lang_services?Object.keys(e.lang_services):null})));o.some((e=>e.available))||l(Error(se)),n(o)}else"IN_PROGRESS"===a.polling_state&&e<30?setTimeout((()=>d(e+1)),1e3):"NO_LONGER_AVAILABLE"===a.polling_state?l(Error(se)):l(Error(a.error_messages[0]||le))})).catch((()=>{l(Error(le))}))};d(1)})),de=({productItem:e,onClose:t,onCancellationMessageDisplay:a})=>{var{page:i}=l(),s=n(),u=f(),d=g(),c=C(),{localize:I}=v(),_="MOBILE"===m(),k=Z([e]),P=X([e],u),b="abandonedCheckoutModule",y=o(((e,t)=>{d({actionType:"click",team:"Attractions",itemName:e,itemGroup:b,customData:t||P,page:i})}),[b,P,d,i]),[D,w]=r(!1);return"PAST_CHECKIN_DATE"===e.notificationType&&(e=>{var[t,a,o]=e.split("-").map((e=>parseInt(e,10)));return new Date(t,a-1,o)})(e.checkinDate)<new Date?null:S(ae,{numItems:1,showLTSODisclaimer:k,onModalClose:()=>{J.setCheckoutPopupInfo(s,e.productCode,e.tourGradeCode,!0),K.updateCartInfoIsDismissed(!0),y("closeCheckoutModule"),t()},continueButton:S(p,{variant:"commerce",size:"medium",onClick:()=>{y("continueCheckout_click"),w(!0),z({productCode:e.productCode,productName:e.tourGradeCode,date:e.checkinDate,ageBands:new Map(e.passengerMix.filter((e=>e.count>0)).map((e=>[e.bandId,e.count]))),partnerName:null,locationId:e.locationId}).then((t=>{if(!((e,t)=>t.some((t=>t.available&&t.gradeCode===e)))(e.tourGradeCode,t))throw new Error;window.location.href="/ShoppingCartCheckout?isCartless=true"})).catch((()=>{window.location.href=null!=e&&e.productUrl?e.productUrl:"/Attractions"}))},fullWidth:_,loading:D,"aria-label":I.string("attractions.cart_rechecking_alert"),children:S(h,_?{id:"attractions.booking.checkout"}:{id:"attractions_checkout_abandonment_popup_continue_checkout"})}),viewDetailsButton:S(p,{variant:"secondary-commerce",size:"medium",target:"_blank",href:e.productUrl,fullWidth:_,marginRight:"spacing-03",onClick:()=>{y("clickViewDetails"),J.setCheckoutPopupInfo(s,e.productCode,e.tourGradeCode,!1)},children:S(h,{id:"attractions_checkout_abandonment_popup_view_details"})}),productContent:S(U,{productItemData:e,onClick:()=>{y("productItemClick",JSON.stringify({prc:e.priceFormatted,cur:u,apc:e.productCode,lid:e.locationId,sprc:e.strikeThroughPrice})),t()},onCancellationMessageDisplay:a}),onModalVisibility:()=>{J.setCheckoutPopupInfo(s,e.productCode,e.tourGradeCode,!1),c({team:"Attractions",itemName:"abandonedCartVisibleImpression",itemGroup:b,customData:P,page:i})}})},ce=e=>{var t,a,o,r,i,n,l;return{likelyToSellOut:null==(t=e.productParameters.bookingProduct)?void 0:t.likely_to_sell_out,notificationType:e.notificationType||void 0,tourGradeCode:e.productParameters.tourGradeCode,productCode:e.productParameters.productCode,productUrl:(null==(a=e.productParameters.bookingProduct)?void 0:a.detail_url)||"",tourGradeName:e.display.gradeName,tourDate:e.productParameters.checkinDateUI,cancellationCondition:e.productParameters.cancellationCondition||"",cancellationConditionFeePercentage:e.productParameters.cancellationConditionFeePercentage,passengerMix:e.display.passengerMix.map((e=>({bandId:e.bandId,count:e.count,pricePerTravelerFormatted:e.pricePerTravelerFormatted,strikePricePerTravelerFormatted:e.strikePricePerTravelerFormatted}))),price:e.availability.price||0,priceFormatted:e.availability.priceFormatted||"",productName:e.display.productName,rating:(null==(o=e.productParameters.bookingProduct)?void 0:o.rating)||0,numReviews:(null==(r=e.productParameters.bookingProduct)?void 0:r.num_reviews)||0,imageUrl:e.display.imageUrl,checkinDate:e.productParameters.checkinDate,locationId:e.productParameters.locationId,labelData:{isSpecialOffer:(null==(i=e.productParameters.bookingProduct)?void 0:i.special_offer)||!1,isLtso:(null==(n=e.productParameters.bookingProduct)?void 0:n.likely_to_sell_out)||!1,isRNPLEligible:e.isRNPLEligible,isBestSeller:(null==(l=e.productParameters.bookingProduct)?void 0:l.is_best_seller)||!1},isRefundableForBooking:e.productParameters.isRefundableForBooking}},pe=()=>{var[e,t]=r(!0),o=n(),l=i((()=>K.isPopupExpired(o)),[o]),s=i((()=>J.isPopupExpired(o)),[o]);a((()=>{J.clearOutdatedStoredValues(),K.clearOutdatedStoredValues(),J.tryResetDismissValue(),K.tryResetDismissValue()}),[]);var{checkoutItem:u,cartItems:d}=L({cart:l,checkout:s}),{checkoutItemData:c,cartItemsData:p}=((e,t)=>({cartItemsData:(null==t?void 0:t.map((e=>ce(e))))||null,checkoutItemData:e?ce(e):null}))(u,d),m=A();if(!u&&!d)return null;var g=!!c&&J.shouldShowPopup({productCode:c.productCode,tourGradeCode:c.tourGradeCode}),C=!!p&&K.shouldShowPopup(K.buildCartProductInfo(p));if(e){if(C&&g&&p&&c)return"CART"===G()?S(W,{productItems:p,onClose:()=>t(!1),onCancellationMessageDisplay:m}):S(j,{productItem:c,onClose:()=>t(!1),onCancellationMessageDisplay:m});if(g&&c)return S(j,{productItem:c,onClose:()=>t(!1),onCancellationMessageDisplay:m});if(C&&p)return S(W,{productItems:p,onClose:()=>t(!1),onCancellationMessageDisplay:m})}return null},me=()=>{var{page:e,fragment:t}=l();return"AttractionsNear"===e||"AttractionsFusion"===e||"Attraction_Review"===e||"AttractionProductsFusion"===e||"AttractionProductReview"===e?"SHOW_BOOKING"===t||"SHOW_TICKETS"===t?null:S(pe,{}):null};return[()=>{E=72e5,B=6048e5,F=2592e6,R=72e5,V=6048e5,x=2592e6,G=Q,L=Y,U=re,W=ie,z=ue,j=de,e({AbandonedCartFreqController:K,AbandonedCheckoutFreqController:J,default:me})},[e=>(a=e.useEffect,o=e.useCallback,r=e.useState,i=e.useMemo),e=>n=e.useSessionId,e=>l=e.useRoute,e=>s=e.default,e=>u=e.default,e=>d=e.useViatorClickOffContext,e=>c=e.useFetchShoppingData,e=>p=e.default,e=>m=e.useViewportCategory,e=>g=e.default,e=>C=e.default,e=>(h=e.default,f=e.useCurrency,I=e.UnsafeLocalize,v=e.useLocalize),e=>(_=e.buildProductDataLabels,k=e.useCartUrlWithFunnelKey),e=>(P=e.Modal,b=e.ModalContainer),e=>y=e.default,e=>D=e.useOnVisible,e=>(w=e.jsxs,S=e.jsx,T=e.Fragment),e=>O=e.HorizontalMerchandisingCard,e=>M=e.default,e=>N=e.default,e=>A=e.useChangeFreeCancellationToFullyRefundableTest]]},["1o4yt4","1al4vi","fgwvq1","19b9b1","1j8lyt","1tbwmx","wv1t5y","jppfwt","1ys6v1","1r73jw","xg719z","17thqz","7ovr7c","1i3sz5","1essqv","13btuy","121h32","1asj0s","9fds1k","1ih6dd","qg79p5"]]);
