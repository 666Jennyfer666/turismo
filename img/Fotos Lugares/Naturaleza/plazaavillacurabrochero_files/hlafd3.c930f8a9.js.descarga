(this.$WP=this.$WP||[]).push(["hlafd3",(e,n)=>{"use strict";var o,l,a,r,i,t,s,u,c,d,g,f,p,m,y,C,v,h,S,b,w,K,M,P,k,I,O,L,_,x,B,T,U,N,q,V,D,G,R,A=({onSuccess:e,onClose:n,variant:o,disableClose:l=!1,funnelKey:t,pid:s,requireSecure:u,forceLogin:c,additionalInfo:C})=>{var v=f(),{page:h}=p(),S=m(),b=i(),[w,K]=a(!0),[M,P]=a("splash");return r((()=>{K("splash"===M)}),[M,K]),y(d,{onClose:()=>{n&&n()},onBack:()=>(()=>{var e,n;v({actionType:"click",actionSubType:"OptimusLoginModalClick",itemType:"optimusLoginModalBackButton",team:"Plus",externalKey:t,pageUid:S,itemName:"OptimusLoginModal",page:h});var o=JSON.stringify({action:"back"});null==(e=b.current)||null==(n=e.contentWindow)||n.postMessage(o,"*")})(),hideCloseButton:l,hideBackButton:w,overrideContentStyling:!0,children:y(g,{pid:s,funnelKey:t,onLoginSuccess:()=>{e&&e()},variant:o,requireSecure:u,forceLogin:c,additionalInfo:C,onFlowStepChange:e=>{P(e)},forwardedRef:b})})},F=()=>{var e=b(),{getDiscountCode:n}=K(),o=n(),l=!o,{subscriptionPrice:a,fetching:r}=w(e,o,l,"CHECKOUT");if(r)return null;var i=null==a?void 0:a.trialPeriod;return((null==i?void 0:i.numberOfDays)||0)>0?"testFreeTrial":"test"},E=["OPTIMUS_BRANDED_IMAGE_HIGHLIGHT"],H=({allowClose:e,flow:n,forceLogin:r,useValuePropVariant:i=!0,contextualMessagingVariant:c,contextualMessageKey:d,contextualMessageParamKey:g,contextualMessageParam:f,contextualMessageSubheaderKey:p,isSignInOnly:m,onClose:C,onFailure:v,funnelKey:S,pid:b=40777,additionalInfoOnLoginContent:w,variantOverride:K})=>{var M=h(),{login:P,close:k}=o(),[I,O]=a({onClose:void 0,onSuccess:void 0,funnelKey:void 0,requireSecure:!1}),L=V();K&&(L=K);var _=t((()=>({...c?{}:{contextualMessage:d,contextualMessageParamKey:g,contextualMessageParam:f,contextualMessageSubheader:p},isSignInOnly:m,contextualMessagingVariant:c,funnelKey:S})),[d,f,g,p,c,m,S]),x=E.includes((n||"").toUpperCase()),B=l((()=>L&&"control"!==L?y(q,{variant:L,pid:b,funnelKey:I.funnelKey||S,onClose:I.onClose,onSuccess:I.onSuccess,disableClose:!e,requireSecure:I.requireSecure,forceLogin:I.requireSecure,additionalInfo:w}):null),{},[I]),T=s(void 0),U=u(((n,o)=>M&&!r?Promise.resolve({userId:M,hasCreatedMember:null}):(T.current||(T.current=new Promise((l=>{O({onClose:()=>{e&&(B.close(),T.current=null,C&&C())},onSuccess:()=>{var e={userId:M||null,hasCreatedMember:null};B.close(),n&&n(),T.current=null,l(e)},funnelKey:o,requireSecure:r}),B.open()}))),T.current)),[B,M,O,r,e,C]),N=w&&w.get("email")||"",D=u(((o,l)=>P({flowOrigin:"login",flow:n,isFullWidthMobile:!0,forceLogin:r,requireSecure:r,closeX:e,closeOnDocClick:e,hideBoxShadow:x,extraQueryParams:{..._,funnelKey:l||S,email:N},pid:b,onSuccess:o||void 0,onClose:C,onFailure:v})),[P,n,r,e,x,_,S,b,C,v,N]);return null===L?{login:null,close:()=>{}}:{login:i&&"control"!==L?U:D,close:k}},$=({members:e,nonMembers:n,messageVariant:o,onClose:l,flow:i="OPTIMUS_BRANDED",funnelKey:t,pid:s})=>{var{isWebview:c}=M(),d=h(),g=k(),{login:f}=D({allowClose:!0,forceLogin:!1,...o&&{flow:i,contextualMessagingVariant:o},onClose:l,funnelKey:t,pid:s}),[p,m]=a(!1),{data:y,fetching:C}=P();return r((()=>{(d||c)&&p&&!C&&(m(!1),null!=y&&y.isSubscribed?g(e):g(n))}),[y,C,e,g,n,p,d,c]),u((()=>{d||c?m(!0):f&&f((()=>{m(!0)}))}),[f,m,d,c])},W=()=>{var e=I(),{page:n}=p();return u((({locationId:o,listingKey:l=null,funnelKey:a})=>{if(!o||!a)throw new Error(`Unable to record user login. Missing offer data - ${JSON.stringify({locationId:o,funnelKey:a})}`);e({OptimusOffer:{optimusInitialOfferSignedIn:{servletName:n,locationId:o,funnelKey:a,listingKey:l}}})}),[e,n])},j="PlusHadBlockedCards",z=()=>{var[e,n]=a(!1),[o,l]=a(new Map);return{failedCardPayment:u((a=>{if(a&&!e){var r=o.get(a);r||(r=0),(r+=1)>=5&&(n(!0),L.set(j,!0),r=0),l(new Map(o.set(a,r)))}}),[e,n,o]),hasBlockedCardInSession:u((()=>e),[e]),hadBlockedCard:u((()=>!!e||L.has(j)),[e]),clearAllBlockedCards:u((()=>{e&&n(!1),L.has(j)&&L.remove(j)}),[e,n])}},J=({children:e,forceLogin:n,loginContextualMessageKey:o,shouldLogoutAfterPaymentFailures:l=!1,renderBeforeLogout:i})=>{var{funnelKey:t}=c(O),[s,d]=a(!n),[g,f]=a(!1),m=p(),{failedCardPayment:v,hasBlockedCardInSession:S,hadBlockedCard:b,clearAllBlockedCards:w}=G(),K=b()?"plus_too_many_failed_payments":o,{login:M}=D({allowClose:!1,forceLogin:n,contextualMessageKey:K,funnelKey:t,useValuePropVariant:!b()}),P=h();r((()=>{P&&s||g||!M||(f(!0),M((()=>d(!0))).finally((()=>f(!1))))}),[M,s,g,P]);var k=u((()=>{window.location.href=`/RegistrationController?flow=${encodeURIComponent("SIGN_OUT")}&pid=${encodeURIComponent(String(D))}&returnTo=${encodeURIComponent(m.path)}&fullscreen=true`}),[m.path]),I=l&&S();return r((()=>{I&&k()}),[I,k]),I?i?y(C,{children:i()}):null:P&&s?(w(),y(C,{children:e({userId:P,failedCardPayment:v})})):null},Q={__key:30055355565844,id:"1b55cecac7149011bb07b92e7da7355c",loc:{},definitions:[]},X=e=>!(null==e||!e.canAccessSecureContent),Y=()=>{var e=h(),[n,o]=a(null),[l,i]=_({query:Q,pause:!e},X);return r((()=>{e!==n&&(o(e),i())}),[i,n,e]),r((()=>()=>o(null)),[o]),[l,i]},Z=({children:e,contextualMessageKey:n,renderNotSecure:o,skip:l,allowClose:i=!1,onClose:t})=>{var{funnelKey:s}=c(O),{login:u,close:d}=D({allowClose:i,forceLogin:!0,contextualMessageKey:n,funnelKey:s,onClose:t}),[{data:g,fetching:f},p]=R(),[m,v]=a(!1);return r((()=>{g||f||m||l||!u||u((()=>{p(),v(!0)}))}),[g,p,f,u,m,v,l]),r((()=>()=>d()),[d]),g||l?y(C,{children:e()}):o?y(C,{children:o()}):null},ee=({messagingVariant:e,view:n,flow:o,bookingFlow:l,plusBrandedModal:a=!1,onLoginSuccess:r})=>{var{funnelKey:i}=c(O),{page:t}=p(),s=m(),u=U(),d=h(),{login:g}=D({allowClose:!0,funnelKey:i,useValuePropVariant:a}),C=N(),b=f(),w=x((()=>{C({externalKey:i,itemName:"LoginPrompt",itemType:"OptimusGuestCheckout",page:t,pageUid:s,sessionId:u,team:"Plus",userId:d,customData:JSON.stringify({view:n,flow:o,checkoutType:"PAGE",booking_flow:l})})}));return y("div",{ref:w,children:v(T,{variant:"title-05",children:[y(S,"member"===e?{id:"member_login_prompt_already_ta_member"}:{id:"member_login_prompt_already_plus_member"}),y(B,{onClick:()=>{b({actionType:"click",externalKey:i,itemGroup:n,itemName:"LoginPrompt",itemType:"OptimusGuestCheckout",page:t,pageUid:s,sessionId:u,team:"Plus",userId:d,customData:JSON.stringify({checkoutType:"PAGE",view:n,flow:o,loginType:a?"plus":"default",booking_flow:l})}),g&&g(r)},marginLeft:"spacing-01",disabled:null===g,children:y(S,{id:"member_login_prompt_sign_in"})})]})})};return[()=>{q=A,V=F,G=z,R=Y,e({MemberLoginPrompt:ee,OptimusHardGate:J,OptimusSecureLoginGate:Z,useOptimusLogin:D=H,useOptimusLoginNavigation:$,useOptimusLoginTracking:W})},[e=>o=e.default,e=>l=e.useVDOMPortal,e=>(a=e.useState,r=e.useEffect,i=e.createRef,t=e.useMemo,s=e.useRef,u=e.useCallback,c=e.useContext),e=>d=e.ModalContainer,e=>g=e.default,e=>f=e.default,e=>(p=e.useRoute,m=e.usePageviewUid),e=>(y=e.jsx,C=e.Fragment,v=e.jsxs),e=>h=e.useUserId,e=>(S=e.default,b=e.useCurrency),e=>w=e.useOptimusSubscriptionPriceQuery,e=>K=e.useDiscountCodePersistance,e=>M=e.useUserAgent,e=>P=e.useOptimusSubscriptionStatusRaw,e=>k=e.useNavigate,e=>I=e.useInteractionLogger,e=>O=e.FunnelTracking,e=>L=e.default,e=>_=e.default,e=>x=e.useOnVisible,e=>B=e.BorderlessButton,e=>T=e.default,e=>U=e.useSessionId,e=>N=e.default]]},["rdycz1","14euae","1o4yt4","1i3sz5","1l8km3","1r73jw","fgwvq1","121h32","52far5","17thqz","i9ixrv","36016d","1nnprh","1g6kun","10ad67","32pwc7","1kkqcv","19b9b1","l47ri7","13btuy","jppfwt","1essqv","1al4vi","xg719z"]]);
